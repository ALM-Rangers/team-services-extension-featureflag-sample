define(["q"],function(e){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16)}([function(e,t,n){function r(e){return c.btoa(unescape(encodeURIComponent(e)))}function o(e){return r(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function a(e){return JSON.parse(JSON.stringify(e))}function i(e,t){var n={};if(!e||!t)return{};for(var r in e)e.hasOwnProperty(r)&&t[r]!==e[r]&&(n[r]={previous:e[r],current:t[r]});return n}var c=n(4);e.exports={btoa:r,base64URLEncode:o,clone:a,modifications:i}},function(t,n){t.exports=e},function(e,t,n){var r,o;r=[n,t,n(3),n(1)],void 0!==(o=function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.envId="590348c958ed570a3af8a496"}return e.init=function(t){var o=this,a=r.defer();return this.instance||(this.instance=new e,this.hashUserKey(t,!0).then(function(e){o.instance.ldClient=n.initialize(o.instance.envId,t,{hash:e}),o.instance.ldClient.on("change",function(e){o.setFlags()}),o.user=t,a.resolve(o.instance)})),a.promise},e.setFlags=function(){this.flags=this.instance.ldClient.allFlags()},e.updateFlag=function(e,t){this.flags[e]=t},e.trackEvent=function(e){this.instance.ldClient.track(e)},e.hashUserKey=function(e,t){var n=r.defer();return t?$.ajax({url:this.UriHashKey,contentType:"application/json; charset=UTF-8",type:"POST",dataType:"json",headers:{"Access-Control-Allow-Origin":"*"},data:"{'userkey':'"+e.key+"'}",success:function(e){n.resolve(e)}}):n.resolve(e.key),n.promise},e.updateUserFeature=function(e,t,n){var o=r.defer();return e?$.ajax({url:this.UriUpdateFlagUser,contentType:"application/json; charset=UTF-8",type:"POST",dataType:"json",headers:{"Access-Control-Allow-Origin":"*"},data:"{'userkey':'"+e.key+"', 'active':"+t+", 'feature' : '"+n+"' }",success:function(e){o.resolve(e)}}):o.resolve(e.key),o.promise},e}();o.UriHashKey="https://vstsextcrypto.azurewebsites.net/api/GetHashKey?code=aqi3cVQPaTfQaT0dBaQoJ0k/LiVlZVmQU4FRHpgbKPHbHIuZ9y4eoA==",o.UriUpdateFlagUser="https://vstsextcrypto.azurewebsites.net/api/UpdateUserFeature?code=erZlsJHBh9u/bwO1ZCO4czrvzqMA9XpUJjV6a9wHuMM1ajwprmcOKw==",t.LaunchDarklyService=o}.apply(t,r))&&(e.exports=o)},function(e,t,n){function r(e){S.enqueue({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})}function o(e,t,n){var r=U.getUser(),o=JSON.stringify(t)+(r&&r.key?r.key:"")+e,a=new Date,i=V[o];i&&a-i<3e5||(V[o]=a,S.enqueue({kind:"feature",key:e,user:r,value:t,default:n,creationDate:a.getTime()}))}function a(e,t){var n={kind:e,key:t.key,data:null,url:window.location.href,creationDate:(new Date).getTime()};return"click"===e&&(n.selector=t.selector),S.enqueue(n)}function i(e,t,n){U.setUser(e),m.fetchFlagSettings(U.getUser(),t,function(e,t){e&&console.warn("Error fetching flag settings: ",e),t&&d(t),n&&n()})}function c(e,t){var n;return n=P&&P.hasOwnProperty(e)?null===P[e]?t:P[e]:t,o(e,n,t),n}function s(){var e={};if(!P)return e;for(var t in P)P.hasOwnProperty(t)&&(e[t]=c(t,null));return e}function u(e){if(!N||0===N.length)return!1;for(var t=0;t<N.length;t++)if("custom"===N[t].kind&&N[t].key===e)return!0;return!1}function l(e,t){if("string"!=typeof e)throw I.invalidKey();N&&!u(e)&&console.warn(I.unknownCustomEventKey(e)),S.enqueue({kind:"custom",key:e,data:t,url:window.location.href,creationDate:(new Date).getTime()})}function f(){k.connect(function(){m.fetchFlagSettings(U.getUser(),E,function(e,t){e&&console.warn("Error fetching flag settings: ",e),d(t)})})}function d(e){var t,n;e&&(t=R.modifications(P,e),n=Object.keys(t),P=e,T&&localStorage.setItem(v(w,U.getUser()),JSON.stringify(P)),n.length>0&&(n.forEach(function(e){b.emit(H+":"+e,t[e].current,t[e].previous)}),b.emit(H,t),n.forEach(function(e){o(e,t[e].current)})))}function p(e,t,n){e.substr(0,H.length)===H?(k.isConnected()||f(),b.on.apply(b,[e,t,n])):b.on.apply(b,Array.prototype.slice.call(arguments))}function g(){b.off.apply(b,Array.prototype.slice.call(arguments))}function h(e){if(e.origin===x&&"SYN"===e.data.type){window.editorClientBaseUrl=x;var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=x+e.data.editorClientUrl;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}}function v(e,t){var n="";return t&&t.key&&(n=t.key),"ld:"+e+":"+n}function y(e,t,n){function o(){setTimeout(function e(){S.flush(U.getUser()),setTimeout(e,K)},K)}function i(){C&&C.dispose(),N&&N.length&&(C=q(N,a))}var c;if(n=n||{},w=e,P="object"==typeof n.bootstrap?n.bootstrap:{},E=n.hash,x=n.baseUrl||"https://app.launchdarkly.com",O=n.eventsUrl||"https://events.launchdarkly.com",L=n.streamUrl||"https://clientstream.launchdarkly.com",k=j(L,w),S=D(O+"/a/"+w+".gif"),b=F(),U=J(t,r),m=A(x,w),c=v(w,U.getUser()),"object"==typeof n.bootstrap)setTimeout(function(){b.emit($)},0);else if("string"==typeof n.bootstrap&&"LOCALSTORAGE"===n.bootstrap.toUpperCase()&&"undefined"!=typeof Storage){T=!0;try{P=JSON.parse(localStorage.getItem(c))}catch(e){localStorage.setItem(c,null)}null===P?m.fetchFlagSettings(U.getUser(),E,function(e,t){e&&console.warn("Error fetching flag settings: ",e),P=t,t&&localStorage.setItem(c,JSON.stringify(P)),b.emit($)}):(setTimeout(function(){b.emit($)},0),m.fetchFlagSettings(U.getUser(),E,function(e,t){e&&console.warn("Error fetching flag settings: ",e),t&&localStorage.setItem(c,JSON.stringify(t))}))}else m.fetchFlagSettings(U.getUser(),E,function(e,t){e&&console.warn("Error fetching flag settings: ",e),P=t,b.emit($)});return m.fetchGoals(function(e,t){e&&console.warn("Error fetching goals: ",e),t&&t.length>0&&(N=t,C=q(N,a))}),"complete"!==document.readyState?window.addEventListener("load",o):o(),window.addEventListener("beforeunload",function(){S.flush(U.getUser(),!0)}),N&&N.length>0&&(window.history&&history.pushState?window.addEventListener("popstate",i):window.addEventListener("hashchange",i)),window.addEventListener("message",h),M}var w,S,m,k,b,E,U,x,O,L,C,T,N,D=n(7),F=n(6),q=n(8),j=n(11),A=n(10),J=n(9),R=n(0),I=n(12),P={},$="ready",H="change",K=2e3,V={},M={identify:i,variation:c,track:l,on:p,off:g,allFlags:s};e.exports={initialize:y},"undefined"!=typeof VERSION&&(e.exports.version=VERSION)},function(e,t,n){!function(){function e(e){this.message=e}var n=t,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",n.btoa||(n.btoa=function(t){for(var n,o,a=String(t),i=0,c=r,s="";a.charAt(0|i)||(c="=",i%1);s+=c.charAt(63&n>>8-i%1*8)){if((o=a.charCodeAt(i+=.75))>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|o}return s}),n.atob||(n.atob=function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,a,i=0,c=0,s="";a=n.charAt(c++);~a&&(o=i%4?64*o+a:a,i++%4)?s+=String.fromCharCode(255&o>>(-2*i&6)):0)a=r.indexOf(a);return s})}()},function(e,t,n){"use strict";var r=/[|\\{}()[\]^$+*?.]/g;e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(r,"\\$&")}},function(e,t){function n(){var e={},t={};return e.on=function(e,n,r){t[e]=t[e]||[],t[e]=t[e].concat({handler:n,context:r})},e.off=function(e,n,r){if(t[e])for(var o=0;o<t[e].length;o++)t[e][o].handler===n&&t[e][o].context===r&&(t[e]=t[e].slice(0,o).concat(t[e].slice(o+1)))},e.emit=function(e){if(t[e])for(var n=0;n<t[e].length;n++)t[e][n].handler.apply(t[e][n].context,Array.prototype.slice.call(arguments,1))},e}e.exports=n},function(e,t,n){function r(e){var t={},n=[],r=!0;return t.enqueue=function(e){n.push(e)},t.flush=function(a,i){var c=2e3-e.length,s=[];if(!a)return r&&console&&console.warn&&console.warn("Be sure to call `identify` in the LaunchDarkly client: http://docs.launchdarkly.com/docs/running-an-ab-test#include-the-client-side-snippet"),!1;for(r=!1;c>0&&n.length>0;){var u=n.pop();u.user=a,c-=o.base64URLEncode(JSON.stringify(u)).length,c<0&&s.length>0?n.push(u):s.push(u)}if(s.length>0){var l=e+"?d="+o.base64URLEncode(JSON.stringify(s));if("withCredentials"in new XMLHttpRequest){var f=new XMLHttpRequest;f.open("GET",l,!i),f.send()}else{(new Image).src=l}}return n.length>0&&(i?t.flush(a,i):setTimeout(function(){t.flush(a)},0)),!1},t}var o=n(0);e.exports=r},function(e,t,n){function r(e,t,n,r){var o,a,c=t.replace(n,"").replace(r,"");switch(e.kind){case"exact":a=t,o=new RegExp("^"+i(e.url)+"/?$");break;case"canonical":a=c,o=new RegExp("^"+i(e.url)+"/?$");break;case"substring":a=c,o=new RegExp(".*"+i(e.substring)+".*$");break;case"regex":a=c,o=new RegExp(e.pattern);break;default:return!1}return o.test(a)}function o(e,t){for(var n=[],r=0;r<t.length;r++)for(var o=e.target,a=t[r],i=a.selector,c=document.querySelectorAll(i);o&&c.length>0;){for(var s=0;s<c.length;s++)o===c[s]&&n.push(a);o=o.parentNode}return n}function a(e,t){for(var n={},e=e,a=null,i=[],c=0;c<e.length;c++)for(var s=e[c],u=s.urls||[],l=0;l<u.length;l++)if(r(u[l],location.href,location.search,location.hash)){"pageview"===s.kind?t("pageview",s):(i.push(s),t("click_pageview",s));break}return i.length>0&&(a=function(e){for(var n=o(e,i),r=0;r<n.length;r++)t("click",n[r])},document.addEventListener("click",a)),n.dispose=function(){document.removeEventListener("click",a)},n}var i=n(5);e.exports=a},function(e,t,n){function r(e){var t=a.clone(e);return t.key&&(t.key=t.key.toString()),t}function o(e,t){var n,o={};return o.setUser=function(e){n=r(e),t(a.clone(n))},o.getUser=function(){return a.clone(n)},e&&o.setUser(e),o}var a=n(0);e.exports=o},function(e,t,n){function r(e,t){var n=new XMLHttpRequest;return n.addEventListener("load",function(){200===n.status&&n.getResponseHeader("Content-type")===s?t(null,JSON.parse(n.responseText)):t(n.statusText)}),n.addEventListener("error",function(){t(n.statusText)}),n.open("GET",e),n.send(),n}function o(e,t){var n={};return n.fetchFlagSettings=function(n,o,s){var u,l=c.base64URLEncode(JSON.stringify(n)),f=[e,"/sdk/eval/",t,"/users/",l,o?"?h="+o:""].join(""),d=function(e){return function(){e.apply(null,arguments),a=null,i=null}}(s);a?(a.abort(),u=function(e){return function(){e&&e.apply(null,arguments),d.apply(null,arguments)}}(i)):u=d,i=u,a=r(f,u)},n.fetchGoals=function(n){r([e,"/sdk/goals/",t].join(""),n)},n}var a,i,c=n(0),s="application/json";e.exports=o},function(e,t){function n(e,t){var n={},e=e+"/ping/"+t,r=null;return n.connect=function(t){"undefined"!=typeof EventSource&&(r=new window.EventSource(e),r.addEventListener("ping",t))},n.disconnect=function(){r&&r.close()},n.isConnected=function(){return r&&(r.readyState===EventSource.OPEN||r.readyState===EventSource.CONNECTING)},n}e.exports=n},function(e,t){e.exports={invalidKey:function(){return"Event key must be a string"},unknownCustomEventKey:function(e){return'Custom event "'+e+'" does not exist'}}},,,,function(e,t,n){var r,o;r=[n,t,n(1),n(2)],void 0!==(o=function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),VSS.require("TFS/Dashboards/WidgetHelpers",function(e){e.IncludeWidgetConfigurationStyles();var t=VSS.getWebContext(),o={key:t.account.name+":"+t.user.email};r.LaunchDarklyService.init(o).then(function(t){t.ldClient.on("ready",function(){VSS.register("widgetId-Configuration",function(){r.LaunchDarklyService.setFlags();var t=function(e){console.log(e),e?$("#display-options").show():$("#display-options").hide()},o=function(e,t){var o=n.defer();return r.LaunchDarklyService.updateUserFeature(r.LaunchDarklyService.user,e,t).then(function(e){console.log(e),o.resolve(e)}),o.promise};!function(){console.log(r.LaunchDarklyService.flags),r.LaunchDarklyService.flags["show-query-details"]?$("#panel-showquerydetails").show():$("#panel-showquerydetails").hide()}(),console.log(r.LaunchDarklyService.flags["mode-result-order"]),$("#enableff").prop("checked",r.LaunchDarklyService.flags["mode-result-order"]),t(r.LaunchDarklyService.flags["mode-result-order"]);var a=$("#query-path");$("enableff");return{load:function(n,i){var c=JSON.parse(n.customSettings.data);return c&&c.queryPath&&a.val(c.queryPath),a.on("change",function(){var t={data:JSON.stringify({queryPath:a.val()})},n=e.WidgetEvent.ConfigurationChange,r=e.WidgetEvent.Args(t);i.notify(n,r)}),$("#enableff").on("change",function(){var e=$("#enableff").is(":checked");t(e),o(e,"mode-result-order").then(function(n){"204"&&(r.LaunchDarklyService.updateFlag("mode-result-order",e),t(e),r.LaunchDarklyService.trackEvent("mode-result-order"))})}),e.WidgetStatusHelper.Success()},onSave:function(){var t={data:JSON.stringify({queryPath:a.val()})};return e.WidgetConfigurationSave.Valid(t)}}}),VSS.notifyLoadSucceeded()})})})}.apply(t,r))&&(e.exports=o)}])});